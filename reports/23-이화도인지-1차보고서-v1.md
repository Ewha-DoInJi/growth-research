<!-- Template for PROJECT REPORT of CapstoneDesign 2024-2H, initially written by khyoo -->
<!-- 본 파일은 2024년도 컴공 졸업프로젝트의 <1차보고서> 작성을 위한 기본 양식입니다. -->
<!-- 아래에 "*"..."*" 표시는 italic체로 출력하기 위해서 사용한 것입니다. -->
<!-- "내용"에 해당하는 부분을 지우고, 여러분 과제의 내용을 작성해 주세요. -->

# Team-Info
| (1) 과제명 | Quantization based on Layer-wise Activation Analysis in Stable Diffusion Models
|:---  |---  |
| (2) 팀 번호 / 팀 이름 | 23-이화도인지 |
| (3) 팀 구성원 | 김도은 (2076035): 리더, *연구 및 논문 작성* <br> 박인애 (2171088): 팀원, *연구 및 논문 작성* <br> 변지은 (2076193) : 팀원, *연구 및 논문 작성*			 |
| (4) 팀 지도교수 | 심재형 교수님 |
| (5) 팀 멘토 | 박준석 멘토님 / 삼성전자 / 수석 연구원 |
| (6) 과제 분류 | 연구 과제 |
| (6) 과제 키워드 | Diffusion model, Quantization, XAI  |
| (7) 과제 내용 요약 | 저희는 diffusion model에서 timestep별로 클래스 및 클래스의 클러스터들이 서로 다른 layer를 활성화시키다는 가설에 기반합니다. 연구의 기반 모델로는 현재 널리 사용되는 diffusion model 중 하나인 latent diffusion model 을 채택하였습니다. computing operation time 절감을 주요 목표로 하여, U-Net 구조을 타겟으로 합니다. layer의 활성화 정도를 파악하기 위하여 activation heatmap을 사용하고, saliency map으로 보다 명확한 시각적 패턴을 도출합니다. 또한, Fisher information matrix를 사용하여 weight의 기여도를 평가하고, 특정 클래스 클러스터에서 중요한 layer를 확인합니다. 이렇게 얻은 정보를 바탕으로 computing operation 절감을 타겟으로 한 quantization을 진행합니다. U-Net의 up layer와 down layer를 대상으로 quantization을 수행하고, 중요한 mid layer는 건드리지 않습니다. quantization은 float 형의 bit 수를 줄이거나, int 형으로 변환하는 방식으로 이루어집니다. 이를 통해 xai 와 diffusion model 의 결합 연구의 성과를 기대할 수 있습니다. 또한, quantization 을 통해 클래스에 특화된 diffusion model의 inference 속도가 향상될 것으로 기대됩니다. |

<br>

# Project-Summary
| 항목 | 내용 |
|:---  |---  |
| (1) 문제 정의 | Stable Diffusion 모델은 이미지 생성 과정에서 각 time step마다 이미지를 생성하는 방식을 채택하고 있습니다. 이로 인해 전체 생성 시간이 상당히 길어지는 고질적인 문제점이 존재합니다. 이는 실시간 응용 및 대규모 이미지 생성 작업에서 주요한 제약 요인으로 작용하고 있습니다. (본 연구의 특성상 특정 상업 고객층을 명확히 정의하기는 어려우나 연구의 주요 수혜자 및 잠재적 사용자 그룹은 AI 연구자 및 개발자가 될 것으로 예상됩니다.)  |
| (2) 기존연구와의 비교 | 기존의 접근 방식 중 하나로 양자화 기법이 사용되어 왔습니다. 양자화는 모델의 연산 속도를 향상시키는 데 효과적이나, 이미지 품질의 현저한 저하를 초래할 수 있다는 한계점이 있습니다. 따라서 속도와 품질 사이의 균형을 유지하는 것을 목표로 레이어 활성화도에 따른 선택적 양자화를 적용할 계획입니다. |
| (3) 제안 내용 | 본 연구에서는 XAI(설명 가능한 인공지능) 기법을 활용하여 Stable Diffusion 모델의 속도를 개선하되, 이미지 품질 저하를 최소화하고자 합니다. 구체적으로, 각 timestep에서 활성화되는 레이어를 분석하고, 그 활성화 정도에 따라 선택적으로 양자화를 적용하는 방법을 제안합니다. 이를 통해 연산 속도의 향상과 이미지 품질 유지 사이의 최적점을 찾고자 합니다. |
| (4) 기대효과 및 의의 | 제안된 방법을 통해 다음과 같은 효과를 기대할 수 있습니다: <br> 1. 연산 속도의 향상: 선택적 양자화를 통해 전체적인 이미지 생성 시간을 단축할 수 있습니다. <br> 2. 이미지 품질 유지: 중요 레이어의 정밀도를 보존함으로써 기존 양자화 방식 대비 우수한 이미지 품질을 유지할 수 있습니다. <br> 3. 모델 해석 가능성 향상: XAI 기법의 활용을 통해 모델의 동작 원리에 대한 이해를 증진시킬 수 있습니다. |
| (5) 주요 기능 리스트 | Saliency map, Fisher Information Matrix, PTQD, Latent Diffusion Model |

<br>
 
# Project-Design
| 항목 | 내용 |
|:---  |---  |
| (1) 요구사항 정의 | 모델 및 동작 알고리즘 구조 사진, ReadMe 문서 작성 |
| (2) 전체 시스템 구성 | 사용자가 양자화된 Diffusion Model을 이용하여 prompt message 또는 클래스를 입력하면 빠르게 생성된 이미지를 얻을 수 있습니다. 사용된 주요 SW 모듈은 Python, Pytorch, DDIM 입니다. |
| (3) 진척도 및 검증내역 | 스타트 단계 때 학회에 참가하면서 Diffusion Model에 XAI를 적용하여 time step과 레이어 마다 생성에 초점을 맞추는 부분이 달라지는 것을 확인하였습니다. 이러한 실험 결과를 통해 양자화를 레이어별로 다르게 적용하면 좋을 것 같다는 교수님의 조언을 전달받았습니다. 그로쓰 학기 중의 진척도는 30%입니다. 전체 모델 양자화 및 activation map을 확인하는 실험 코드를 작성한 상태이고, 시각화를 마무리한 후에 커스텀 양자화를 진행하고, 결과 도출 후 논문 작성을 할 예정입니다. |
| (4) 기타 | 10월 중순에 학회 참가 예정입니다. |

<br>
